<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>AnimationScene Test</title>
</head>
<body>
  <h1>AnimationScene Test</h1>
  <div id="output"></div>

  <script type="module">
    import { AnimationScene } from './animation-scene.js';
    import { AnimationDate } from './animation-date.js';

    // Helper to log to page
    function log(msg) {
      document.getElementById('output').innerHTML += `<pre>${msg}</pre>`;
    }

    function assert(condition, message, ...args) {
      if (!condition) {
        console.error(message || "Assertion failed", ...args);
        return false;
      }
      return true;
    }
    function assertNull(obj) {
      assert(!obj, "assertNull(obj)", obj);
    }
    function assertNotNull(obj) {
      assert(obj, "assertNotNull(obj)", obj);
    }

    function assertEqualDate(obj1, obj2) {
      assert(obj1.getTime() === obj2.getTime(), `assertEqualDate(obj1, obj2): obj1.time:${obj1.getTime()}, obj2.time:${obj2.getTime()}`, obj1, obj2);
    }
    function assertLessThanDate(obj1, obj2) {
      assert(obj1.getTime() < obj2.getTime(), `assertLessThanDate(obj1, obj2): obj1.time:${obj1.getTime()}, obj2.time:${obj2.getTime()}`, obj1, obj2);
    }
    function assertLessOrEqualThanDate(obj1, obj2) {
      assert(obj1.getTime() < obj2.getTime() || obj1.getTime() === obj2.getTime(), `assertLessOrEqualThanDate(obj1, obj2): obj1.time:${obj1.getTime()}, obj2.time:${obj2.getTime()}`, obj1, obj2);
    }
    function assertGreaterThanDate(obj1, obj2) {
      assert(obj1.getTime() > obj2.getTime(), `assertGreaterThanDate(obj1, obj2): obj1.time:${obj1.getTime()}, obj2.time:${obj2.getTime()}`, obj1, obj2);
    }
    function assertGreaterOrEqualThanDate(obj1, obj2) {
      assert(obj1.getTime() > obj2.getTime() || obj1.getTime() === obj2.getTime(), `assertGreaterOrEqualThanDate(obj1, obj2): obj1.time:${obj1.getTime()}, obj2.time:${obj2.getTime()}`, obj1, obj2);
    }

    function truncateToSecond(date) {
      return new Date(
        date.getFullYear(),
        date.getMonth(),
        date.getDate(),
        date.getHours(),
        date.getMinutes(),
        date.getSeconds()
      );
    }

    function testEmptyAnimationDate() {
      // Given
      const animationDate = new AnimationDate();

      // When
      const scene = new AnimationScene(config);

      // Then
      const dateStart = AnimationDate.toDate(scene.getDateStart());
      const dateEnd = AnimationDate.toDate(scene.getDateEnd());

      // Assert
      assertNotNull(scene);
      assertNotNull(dateStart);
      assertNotNull(dateEnd);
      assertLessThanDate(dateStart, dateEnd);
      assertLessOrEqualThanDate(dateStart, now);
      assertGreaterOrEqualThanDate(dateEnd, now);
    }
    testEmptyAnimationDate();

    function testAnimationDate() {
      // Given
      const date = new AnimationDate();
    }
    testAnimationDate();

    function testIdentity() {
      // Given
      const now = truncateToSecond(new Date());
      const config = null;

      // When
      const scene = new AnimationScene(config);

      // Then
      const dateStart = AnimationDate.toDate(scene.getDateStart());
      const dateEnd = AnimationDate.toDate(scene.getDateEnd());

      // Assert
      assertNotNull(scene);
      assertNotNull(dateStart);
      assertNotNull(dateEnd);
      assertLessThanDate(dateStart, dateEnd);
      assertLessOrEqualThanDate(dateStart, now);
      assertGreaterOrEqualThanDate(dateEnd, now);
    }
    testIdentity();
    
    function testBothEmpty() {
      // Given
      const now = truncateToSecond(new Date());
      const config = {
        date_start: {},
        date_end: {}
      };

      // When
      const scene = new AnimationScene(config);

      // Then
      const dateStart = AnimationDate.toDate(scene.getDateStart());
      const dateEnd = AnimationDate.toDate(scene.getDateEnd());

      // Assert
      assertNotNull(scene);
      assertNotNull(dateStart);
      assertNotNull(dateEnd);
      assertLessThanDate(dateStart, dateEnd);
      assertLessOrEqualThanDate(dateStart, now);
      assertGreaterOrEqualThanDate(dateEnd, now);
    }
    testBothEmpty();

    function testBothFullEqual() {
      // Given
      const config = {
        date_start: { year: 2025, month: 9, day: 8, hour: 23, minute: 59, second: 59 },
        date_end: { year: 2025, month: 9, day: 8, hour: 23, minute: 59, second: 59 }
      };

      // When
      const scene = new AnimationScene(config);

      // Then
      const dateStart = AnimationDate.toDate(scene.getDateStart());
      const dateEnd = AnimationDate.toDate(scene.getDateEnd());

      // Assert
      assertNotNull(scene);
      assertNotNull(dateStart);
      assertNotNull(dateEnd);
      assertEqualDate(dateStart, dateEnd);
    }
    testBothFullEqual();

    function test1() {
      // Given
      const config = {
        date_start: { year: 2025, month: 9, day: 7 }, // Today
        date_end: { year: 2025, month: 9, day: 8, hour: 23, minute: 59, second: 59 } // Tomorrow
      };
      
      // When
      const scene = new AnimationScene(config);

      // Then
      const dateStart = AnimationDate.toDate(scene.getDateStart());
      const dateEnd = AnimationDate.toDate(scene.getDateEnd());

      // Assert
      assertNotNull(scene);
      assertNotNull(dateStart);
      assertNotNull(dateEnd);
    }

    function test2() {
      const now = new Date();
      const inRange = scene.isInActivationRange(now);
      
      log(`Current time: ${now.toString()}`);
      log(`Is in activation range? ${inRange ? 'Yes' : 'No'}`);
    }
    
  </script>
</body>
</html>
